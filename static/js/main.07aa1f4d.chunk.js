(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{29:function(t,e,n){},36:function(t,e,n){t.exports=n(60)},60:function(t,e,n){"use strict";n.r(e);var i=n(0),o=n.n(i),r=n(24),a=n.n(r),s=n(7),l=n(8),h=n(16),c=n(15),u=n(22),m=n(17),g={EPS:.001,RIR:5,ZMF:.05,MRC:10,DRC:5,DDP:1,DMI:160,DSF:1/700,predefColors:[[1,0,0],[0,1,0],[0,0,1],[0,1,1],[1,0,1],[1,1,0],[1,.5,0],[1,0,.5],[0,1,.5],[.5,.5,.5]]},v=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(s.a)(this,t),this.top=1,this.right=1,this.bottom=-1,this.left=-1,this.original=e?null:new t(!0)}return Object(l.a)(t,[{key:"width",value:function(){return this.right-this.left}},{key:"height",value:function(){return this.top-this.bottom}},{key:"vec4",value:function(){return[this.top,this.right,this.bottom,this.left]}},{key:"zoomFactor",value:function(){return this.original.width()/this.width()}},{key:"setZoomFactor",value:function(t){if(!(t<=0)){var e=.5*this.original.width()/t,n=.5*this.original.height()/t,i=.5*this.right+.5*this.left,o=.5*this.top+.5*this.bottom;this.top=o+n,this.right=i+e,this.bottom=o-n,this.left=i-e}}},{key:"zoom",value:function(t,e,n){var i=t?-g.ZMF:g.ZMF,o=this.width()*i,r=this.height()*i;this.top+=n*r,this.right+=(1-e)*o,this.bottom-=(1-n)*r,this.left-=e*o}},{key:"move",value:function(t,e){var n=t*this.width()/(window.innerWidth-1),i=e*-this.height()/(window.innerHeight-1);this.top+=i,this.right+=n,this.bottom+=i,this.left+=n,null!=this.original&&this.original.move(t,e)}},{key:"resize",value:function(t,e){this.top+=g.DSF*e,this.right+=g.DSF*t,this.bottom-=g.DSF*e,this.left-=g.DSF*t,null!=this.original&&this.original.resize(t,e)}},{key:"reset",value:function(){this.top=g.DSF*window.innerHeight,this.right=g.DSF*window.innerWidth,this.bottom=-g.DSF*window.innerHeight,this.left=-g.DSF*window.innerWidth,null!=this.original&&this.original.reset()}}]),t}(),f=n(13),d=n.n(f),p=function(){function t(e,n){Object(s.a)(this,t),this.x=e,this.y=n}return Object(l.a)(t,[{key:"set",value:function(t,e){this.x=t,this.y=e}},{key:"distance",value:function(e){return new t(this.x-e.x,this.y-e.y)}}]),t}(),b=function t(e,n){Object(s.a)(this,t),this.value=e,this.color=n},w=new(function(){function t(){Object(s.a)(this,t),this.limits=new v,this.maxIterations=g.DMI,this.damping=new d.a(g.DDP,0),this.setRoots(g.DRC)}return Object(l.a)(t,[{key:"setRoots",value:function(t){this.roots=[];for(var e=0;e<t;++e)this.roots.push(new b(new d.a(0,0),g.predefColors[e]));this.reset()}},{key:"reset",value:function(){for(var t=this.roots.length,e=0;e<t;++e){var n=2*Math.PI*e/t;this.roots[e].value=new d.a(Math.cos(n),Math.sin(n))}this.limits.reset()}},{key:"complex2point",value:function(t){var e=(t.re-this.limits.left)*(window.innerWidth-1)/this.limits.width(),n=(t.im-this.limits.top)*(window.innerHeight-1)/-this.limits.height();return new p(e,n)}},{key:"point2complex",value:function(t){var e=t.x*this.limits.width()/(window.innerWidth-1)+this.limits.left,n=t.y*-this.limits.height()/(window.innerHeight-1)+this.limits.top;return new d.a(e,n)}},{key:"distance2complex",value:function(t){return t*this.limits.width()/(window.innerWidth-1)}},{key:"rootContainsPoint",value:function(t){for(var e=this.roots.length,n=0;n<e;++n){var i=this.complex2point(this.roots[n].value).distance(t);if(Math.abs(i.x)<g.RIR&&Math.abs(i.y)<g.RIR)return n}return-1}},{key:"rootsVec2",value:function(){for(var t=[],e=this.roots.length,n=0;n<e;++n){var i=this.roots[n].value.toVector();t.push(i[0],i[1])}return t}},{key:"colorsVec3",value:function(){for(var t=[],e=this.roots.length,n=0;n<e;++n){var i=this.roots[n].color;t.push(i[0],i[1],i[2])}return t}}]),t}()),x=n(11),y=n(30),E=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(h.a)(this,Object(c.a)(e).call(this,t))).state={intent:x.a.NONE,complex:n.props.value},n}return Object(m.a)(e,t),Object(l.a)(e,[{key:"inputChanged",value:function(t){var e=!0,n=t.target.value;try{e=!new d.a(n).isNaN()}catch(i){e=!1}e?(this.setState({intent:x.a.NONE,complex:t.target.value}),this.props.onValueChange(new d.a(t.target.value))):this.setState({intent:x.a.DANGER,complex:t.target.value})}},{key:"render",value:function(){var t=this;return o.a.createElement(y.a,{disabled:this.props.disabled,fill:this.props.fill,large:this.props.large,leftIcon:this.props.leftIcon,intent:this.state.intent,placeholder:this.props.placeholder,rightElement:this.props.rightElement,round:this.props.round,type:this.props.type,value:this.state.complex,onChange:function(e){return t.inputChanged(e)}})}}]),e}(o.a.Component),k="no",C="root",z="fractal",P={mode:k,previousPos:new p(0,0),index:-1},S=new(function(){function t(){Object(s.a)(this,t)}return Object(l.a)(t,[{key:"initializeGL",value:function(t){this.canvas=t,this.gl=this.canvas.getContext("webgl"),this.gl||(this.gl=this.canvas.getContext("experimental-webgl")),this.gl||alert("Your browser does not support WebGL"),this.program=this.gl.createProgram(),this.addShaderFromText("\nprecision mediump float;\nattribute vec2 vPosition;\n\nvoid main()\n{\n\tgl_Position = vec4(vPosition, 0.0, 1.0);\n}\n",this.gl.VERTEX_SHADER),this.addShaderFromText("\nprecision mediump float;\nconst int MIT = 2000;\t\t// Upper limit of max iterations\nuniform float EPS;          // Max error allowed\nuniform float RIR;          // Root indicator radius\nuniform int rootCount;      // Number of roots <= 10\nuniform int maxIterations;  // Maximum number of iterations\nuniform vec2 damping;       // Complex damping factor\nuniform vec2 size;          // Width = x, height = y\nuniform vec4 limits;        // Top = x, right = y, bottom = z, left = w\nuniform vec2 roots[10];     // Real = x, imaginary = y\nuniform vec3 colors[10];    // Rgba\n\nvec2 cmpxcjg(vec2 c)\n{\n\t// Complex conjugate\n\treturn vec2(c.x, -c.y);\n}\n\nvec2 cmpxmul(vec2 a, vec2 b)\n{\n\t// Complex multiplication\n\treturn vec2(a.x * b.x - a.y * b.y, a.y * b.x + a.x * b.y);\n}\n\nvec2 cmpxdiv(vec2 a, vec2 b)\n{\n\t// Complex division\n\treturn cmpxmul(a, cmpxcjg(b)) / dot(b, b);\n}\n\nvec3 rgb2hsv(vec3 c)\n{\n\t// Convert vec3.rgb to vec3.hsv\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\tvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n\t// Convert vec3.hsv to vec3.rgb\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec3 darker(vec3 c, float f)\n{\n\t// Darken the color by f\n\tif (f > 1.0) {\n\t\tvec3 hsv = rgb2hsv(c);\n\t\thsv.z = hsv.z / f;\n\t\treturn hsv2rgb(hsv);\n\n\t// Lighten the color by 1/f\n\t} else if (f < 1.0) {\n\t\tvec3 hsv = rgb2hsv(c);\n\t\thsv.y = hsv.y * f;\n\t\treturn hsv2rgb(hsv);\n\n\t// Do nothing if f == 1.0\n\t} else return c;\n}\n\nvoid func(vec2 z, inout vec2 f, inout vec2 df)\n{\n\t// Test if more than 2 roots\n\tif (rootCount < 2) return;\n\n\t// Calculate f and derivative with given roots\n\tvec2 r = z - roots[0];\n\tvec2 l = z - roots[1];\n\tfor (int i = 1; i < 10 - 1; ++i) {\n\t\t\tif (i >= rootCount - 1) {\n\t\t\t\t f = cmpxmul(r, (z - roots[i]));\n\t\t\t\t break;\n\t\t\t }\n\t\t\tl = cmpxmul((z - roots[i + 1]), (l + r));\n\t\t\tr = cmpxmul(r, (z - roots[i]));\n\t\t}\n\tdf = l + r;\n\t// f = cmpxmul(r, (z - roots[rootCount - 1]));\n}\n\nvoid main()\n{\n\t// Get complex number from pixel position and limits\n\tfloat xFactor = float(limits.y - limits.w) / float(size.x - 1.0);\n\tfloat yFactor = float(limits.z - limits.x) / float(size.y - 1.0);\n\tvec2 z = vec2(gl_FragCoord.x * xFactor + limits.w, (size.y - gl_FragCoord.y) * yFactor + limits.x);\n\n\t// Root indicator if close enough to root\n\tfor (int r = 0; r < 10; ++r) {\n\t\tif (r >= rootCount) break;\n\t\tif (length(z - roots[r]) < RIR - 0.005) {\n\t\t\tgl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);\n\t\t\treturn;\n\t\t} else if (length(z - roots[r]) < RIR) {\n\t\t\tgl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// Newton iteration\n\tfor (int i = 0; i < MIT; ++i) {\n\t\tif (i >= maxIterations) break;\n\t\tvec2 f, df;\n\t\tfunc(z, f, df);\n\t\t//f = cmpxmul(z, cmpxmul(z, z)) - vec2(1.0, 0.0);\n\t\t//df = 3.0 * cmpxmul(z, z);\n\t\tvec2 z0 = z - cmpxmul(damping, cmpxdiv(f, df));\n\n\t\t// Check which root was reached\n\t\tif (length(z0 - z) < EPS) {\n\t\t\tfor (int r = 0; r < 10; ++r) {\n\t\t\t\tif (r >= rootCount) break;\n\t\t\t\tif (length(z0 - roots[r]) < EPS) {\n\n\t\t\t\t\t// Color by root and number of iterations\n\t\t\t\t\tgl_FragColor = vec4(darker(colors[r], float(50 + i * 8) / 100.0), 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tz = z0;\n\t}\n\n\t// No root -> black\n\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n",this.gl.FRAGMENT_SHADER),this.linkProgram(),this.setupVertices()}},{key:"paintGL",value:function(){this.gl.useProgram(this.program),this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,3,this.gl.FLOAT,this.gl.FALSE,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"rootCount"),w.roots.length),this.gl.uniform4fv(this.gl.getUniformLocation(this.program,"limits"),w.limits.vec4()),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"maxIterations"),w.maxIterations),this.gl.uniform2f(this.gl.getUniformLocation(this.program,"damping"),w.damping.re,w.damping.im),this.gl.uniform2f(this.gl.getUniformLocation(this.program,"size"),this.canvas.width,this.canvas.height),this.gl.uniform2fv(this.gl.getUniformLocation(this.program,"roots"),w.rootsVec2()),this.gl.uniform3fv(this.gl.getUniformLocation(this.program,"colors"),w.colorsVec3()),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4)}},{key:"resizeGL",value:function(){w.limits.resize(window.innerWidth-this.canvas.width,window.innerHeight-this.canvas.height),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.paintGL()}},{key:"mousePressEvent",value:function(t){P.previousPos.set(t.clientX,t.clientY);var e=w.rootContainsPoint(new p(t.clientX,t.clientY));e>=0?(P.mode=C,P.index=e):P.mode=z}},{key:"mouseMoveEvent",value:function(t){var e=new p(t.clientX,t.clientY);P.mode===C&&P.index>=0&&P.index<w.roots.length?(w.roots[P.index].value=w.point2complex(e),this.canvas.style.cursor="grabbing",this.paintGL()):P.mode===z?(w.limits.move(P.previousPos.x-e.x,P.previousPos.y-e.y),P.previousPos.set(e.x,e.y),this.canvas.style.cursor="move",this.paintGL()):w.rootContainsPoint(e)>=0?this.canvas.style.cursor="grab":this.canvas.style.cursor="default"}},{key:"mouseReleaseEvent",value:function(t){P.mode=k,P.index=-1,this.paintGL()}},{key:"mouseWheelEvent",value:function(t){var e=t.clientX/this.canvas.width,n=t.clientY/this.canvas.height,i=t.deltaY<0;w.limits.zoom(i,e,n),this.paintGL()}},{key:"addShaderFromText",value:function(t,e){var n=this.gl.createShader(e);this.gl.shaderSource(n,t),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?this.gl.attachShader(this.program,n):console.error("Error compiling shader!",this.gl.getShaderInfoLog(n))}},{key:"linkProgram",value:function(){this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)?(this.gl.validateProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.VALIDATE_STATUS)||console.error("Error validating the program!",this.gl.getProgramInfoLog(this.program))):console.error("Error linking the program!",this.gl.getProgramInfoLog(this.program))}},{key:"setupVertices",value:function(){var t=this.gl.createBuffer();this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),this.gl.STATIC_DRAW),this.gl.uniform1f(this.gl.getUniformLocation(this.program,"EPS"),g.EPS),this.gl.uniform1f(this.gl.getUniformLocation(this.program,"RIR"),w.distance2complex(g.RIR))}}]),t}()),F=n(31),I=n(62),R=n(63),L=n(64),O=(n(29),function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(h.a)(this,Object(c.a)(e).call(this,t))).state={isOpen:!0,size:window.innerWidth.toString()+" x "+window.innerHeight.toString()},document.onkeyup=n.keyPressEvent.bind(Object(u.a)(n)),n}return Object(m.a)(e,t),Object(l.a)(e,[{key:"onStateChanged",value:function(t){this.setState({isOpen:t.isOpen})}},{key:"onZoomChanged",value:function(t){w.limits.setZoomFactor(t/100),S.paintGL()}},{key:"onIterationsChanged",value:function(t){w.maxIterations=t,S.paintGL()}},{key:"onDegreeChanged",value:function(t){w.setRoots(t),S.paintGL()}},{key:"onDampingChanged",value:function(t){w.damping=t,S.paintGL()}},{key:"keyPressEvent",value:function(t){switch(t.keyCode){case 83:this.setState(function(t){return{isOpen:!t.isOpen}});break;case 79:console.log("o was pressed");break;case 80:console.log("p was pressed")}}},{key:"render",value:function(){var t=this;return o.a.createElement(F.slide,{className:"settingsWidget",right:!0,width:320,noTransition:!0,noOverlay:!0,disableAutoFocus:!0,customBurgerIcon:!1,customCrossIcon:!1,isOpen:this.state.isOpen,onStateChange:function(e){return t.onStateChanged(e)}},o.a.createElement(I.a,{className:"bp3-dark"},o.a.createElement("div",{className:"title"},o.a.createElement("h2",null,"NewtonFractal WebGL")),o.a.createElement("div",{className:"settingsItems"},o.a.createElement("div",{className:"item"},o.a.createElement(R.a,null,"Fractal size"),o.a.createElement(y.a,{disabled:!0,value:this.state.size,leftIcon:"fullscreen",fill:!0})),o.a.createElement("div",{className:"item"},o.a.createElement(R.a,null,"Zoom factor (%)"),o.a.createElement(L.a,{value:100*w.limits.zoomFactor(),onValueChange:function(e){return t.onZoomChanged(e)},min:.01,buttonPosition:"right",leftIcon:"zoom-in",fill:!0})),o.a.createElement("div",{className:"item"},o.a.createElement(R.a,null,"Max number of iterations"),o.a.createElement(L.a,{value:w.maxIterations,onValueChange:function(e){return t.onIterationsChanged(e)},min:1,buttonPosition:"right",leftIcon:"repeat",fill:!0})),o.a.createElement("div",{className:"item"},o.a.createElement(R.a,null,"Number of roots"),o.a.createElement(L.a,{value:w.roots.length,onValueChange:function(e){return t.onDegreeChanged(e)},min:2,max:10,buttonPosition:"right",leftIcon:"graph",fill:!0})),o.a.createElement("div",{className:"item"},o.a.createElement(R.a,null,"Damping factor"),o.a.createElement(E,{value:w.damping,leftIcon:"derive-column",fill:!0,onValueChange:function(e){return t.onDampingChanged(e)}})))))}}]),e}(o.a.Component)),D=function(t){function e(){return Object(s.a)(this,e),Object(h.a)(this,Object(c.a)(e).apply(this,arguments))}return Object(m.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){var t=document.getElementById("glcanvas");t.width=window.innerWidth,t.height=window.innerHeight,S.initializeGL(t),window.addEventListener("resize",S.resizeGL.bind(S)),t.onmousedown=S.mousePressEvent.bind(S),t.onmouseup=S.mouseReleaseEvent.bind(S),t.onmousemove=S.mouseMoveEvent.bind(S),t.onwheel=S.mouseWheelEvent.bind(S),S.resizeGL()}},{key:"render",value:function(){return o.a.createElement("canvas",{id:"glcanvas"})}}]),e}(o.a.Component);var N=function(){return o.a.createElement("div",{className:"app"},o.a.createElement(O,{className:"settingsWidget"}),o.a.createElement(D,{className:"fractalWidget"}))};a.a.render(o.a.createElement(N,null),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.07aa1f4d.chunk.js.map